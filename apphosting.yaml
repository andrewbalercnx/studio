# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

runConfig:
  # Allow auto-scaling up to 5 instances under load
  # This prevents CPU/memory-heavy requests (AI flows, PDF generation)
  # from piling onto a single VM and causing crashes
  minInstances: 0
  maxInstances: 5

  # Resource limits for each instance
  # AI and PDF generation are CPU/memory intensive
  cpu: 2
  memoryMiB: 2048

  # Request timeout (5 minutes) for long-running operations
  # Note: Consider moving very long operations to Cloud Functions or Cloud Run Jobs
  timeoutSeconds: 300

  # Concurrency limit per instance
  # Lower value prevents memory exhaustion from parallel heavy requests
  concurrency: 10

# Environment variables and secrets
# Secrets are stored in Google Cloud Secret Manager
# Grant access with: firebase apphosting:secrets:grantaccess
env:
  # API Keys from Secret Manager
  - variable: GEMINI_API_KEY
    secret: GEMINI_API_KEY
    availability:
      - RUNTIME

  - variable: ELEVENLABS_API_KEY
    secret: ELEVENLABS_API_KEY
    availability:
      - RUNTIME

  - variable: FIREBASE_SERVICE_ACCOUNT_KEY
    secret: FIREBASE_SERVICE_ACCOUNT_KEY
    availability:
      - RUNTIME

  - variable: MIXAM_USERNAME
    secret: MIXAM_USERNAME
    availability:
      - RUNTIME

  - variable: MIXAM_PASSWORD
    secret: MIXAM_PASSWORD
    availability:
      - RUNTIME

  - variable: MIXAM_WEBHOOK_URL
    secret: MIXAM_WEBHOOK_URL
    availability:
      - RUNTIME

  - variable: MIXAM_WEBHOOK_SECRET
    secret: MIXAM_WEBHOOK_SECRET
    availability:
      - RUNTIME

  # Note: MIXAM_PAYMENT_METHOD is now configured via Admin Portal (Mixam Catalogue page)
  # and stored in Firestore at systemConfig/mixam

  # Microsoft Graph API credentials for email notifications
  # Uses Azure AD App Registration with Mail.Send permission
  - variable: AZURE_TENANT_ID
    secret: AZURE_TENANT_ID
    availability:
      - RUNTIME

  - variable: AZURE_CLIENT_ID
    secret: AZURE_CLIENT_ID
    availability:
      - RUNTIME

  - variable: AZURE_CLIENT_SECRET
    secret: AZURE_CLIENT_SECRET
    availability:
      - RUNTIME

  # UK Postcode lookup API (getAddress.io)
  - variable: GETADDRESS_API_KEY
    secret: GETADDRESS_API_KEY
    availability:
      - RUNTIME

  # Internal API secret for Claude Code to call internal APIs
  # Generate with: openssl rand -hex 32
  - variable: INTERNAL_API_SECRET
    secret: INTERNAL_API_SECRET
    availability:
      - RUNTIME
